# 2021-02-20 memo

## 現状

Win10 ノートと Win8 ノートの間で数 KB のテキストをやり取りするのに、今は Win8 ノート上の irb で nc もどきを手で書いて、 Win10 ノートの bash (on Cygwin) で /dev/tcp/192.168.foo.bar/baz へ or からリダイレクトし、化けなかったかどうか両ホストで sha256sum 取って目視で比べている。

さて、マシンをまたぐ主役の TCP は8ビットクリーンかつ信頼性があってともかくも、その前後ではクリップボードやらテキスト端末やらを経由するような通信路では何が化けるか分からない。実のところ LF の前に CR が勝手に増えたし、 HT は SP の8個に開かれるんだろうね。それ以外の制御コードがどうなっちゃうのかなんて考えもしたくないので、決断としてこの通信路には単純な ASCII テキストしか流さないことにしている。つまり、そういう単純な ASCII テキストでない限りは base64 で保護。まあ、そのおかげで tgz なんかも流せたりするわけだけど。

上記をまとめると、送るのが単なるバイト列なら、 gzip 圧縮が効くか否かによって `gzip -c | base64` か単なる base64 のどっちを通すかを決めて `>/dev/clipboard` 。送信側でもうファイルの形に保存されてれば、 `tar czf - $files | base64 >/dev/clipboard` 。で、 `sha256sum /dev/clipboard` を見ておく。冒頭の「 nc もどき on irb & リダイレクト」でデータを送受信し、受信側でも sha256sum を取って目で比較。送信側でどのコマンドを使ったのかによって、 `base64 -d | zcat` かただの `base64 -d` か `base64 -d | tar {x|t}zf - $snip` のどれを通してデータを取り出すかが決まる。

……バカじゃないだろうか？　「まとめると」と言ってるほどにはまとまってないし。とはいえこんな手続きを組み立てちゃうメリットがゼロってわけではなくて、両方のマシンに Cygwin の bash, coreutils, gzip, tar あたり、最低限 Base カテゴリのインストールがあれば使えてしまうこと。いや、実際のところ話の流れが逆で、インストール済みのプログラムだけでどうにかできないか試行錯誤した結果がこの手続きなわけだけど。

## 改善

さすがに手作業でこんな運用を続けるのはよくないので、この状況を改善しようと思った。考えているうちにもう1つ理由があることに気がついた: 今は公開してもなんら問題ない情報しか流していないけど、おいおいは機密に保つべき情報も流す見込みが出てきたので、通信路のうち少なくともマシンをまたぐ部分は保護したいというのがそれ。

まず最初に思いついたのは、素の TCP/IP を直接使うのをやめて TLS を通すこと。 TLS に包むプロトコルとしては、データの受信と送信で2種類の操作を行いたいので1ビットあれば区別できるけど、将来の拡張を考えるともう少し柔軟にしたい。では、 HTTP を考えてみようか。なんらかのリソースに対して GET すると受信・ POST すると送信、とでも決められてたいへん覚えやすい。また、 HTTP over TLS には HTTPS という略称があるのは周知のとおりで、既存のツールがたくさんある。これらを活用すれば、自分でやらなきゃならない作業を減らせそうだ。

というわけでいろいろ調べてみるものの。どうにも TLS ってやつは信頼モデルが Web モデルであって、適切なルートにつながる証明書チェインを用意するのが前提にされてるんだよな。普通に HTTPS に使うなら、サーバも認証局も数が多いしまあまあ頻繁に増減するから、この設計はごもっともなんだけど。今回はサーバ1台とクライアント1台をつなぐだけでしかないから、どうにも道具立てが不釣り合いに大げさに見えてしまう。一応ドメインも持ってはいるから、そのあたり要求される事項に手を打てないわけじゃないんだけど、たいへんに面倒。あるいは、リスクを取ってオレオレ証明書で運用するか。どちらも選びたくないなあと悩んでいたら、もう1つ問題に気がついた: Win8 ノートからデータを読み出すだけならまだしも、書き込む操作を提供するからには LAN 内限定であろうとクライアントも認証するべきだろ。クライアント証明書を使うのがストレートだけど、先のサーバ証明書だけでも面倒なやつがつまり2倍。こりゃもう少し考えなおしかな。

で、だ。サーバ・クライアントがお互いを認証して、 Web モデル以外の信頼モデルが使いやすい暗号通信って何があったかなー、と。 https://ja.wikipedia.org/wiki/Category:%E3%82%BB%E3%82%AD%E3%83%A5%E3%82%A2%E9%80%9A%E4%BF%A1 や https://ja.wikipedia.org/wiki/Category:%E6%9A%97%E5%8F%B7%E6%8A%80%E8%A1%93 あたりを眺めながら、改めてやりたいことを考えなおしてみると、 OpenSSH という選択がふと浮かび上がってきた。

Win10 ノートの Cygwin に知らないうちに rsync がインストールされていて「何が依存してるんだ？」と思って調べたり。実は Git からの依存だったってわりとすぐ分かった。とはいえ、 git-archimport という使う人の少なそうな(個人の感想)コマンドからしか依存がなさそうなので、これを別のパッケージに切り出せば rsync の依存外せるんじゃなかろうか。

## 無関係な謎電波の話

v-夕方静かに座っていて音声の謎電波を受信した。アルファベットだと malveboic とでも書けるだろうか。「見た目で mal- が接頭辞、 -ic が形容詞の接尾辞かな？」とか思ったが、電波なので当然 Google 検索でもヒットしない。 Web をうろうろしていたら、カルボン酸かその官能基の接尾辞が -oic だとかいうのを見て、高校化学を思い出すなど。まー (mal)veb(e) ってギリシャ語にもどーにも見えないけどね。いろいろ検索を試したら、 surname が Malvebo さんって方はいらっしゃるようなので「 Malvebo 氏の」あたりの形容詞でひとつ。まあ、ここまで全部、電波をネタにしてネットサーフィンしてただけなんだけどね。
