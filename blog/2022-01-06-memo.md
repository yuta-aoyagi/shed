https://twitter.com/yuuta_aoyagi/status/1475621868657065989

さて、本件の続き。

2021-12-25夕方、Cygwin setup-x86\*.exe で Python 3.9系を指定したら、なぜか3.8と3.9の両方をインストールするトランザクションが算出された。
以前 QEMU 6.1.0をビルドしようとしたときに Python 3.x 系を要求されたというだけの動機であり、そこまで新しいものが欲しいわけじゃないので、一度キャンセルして3.8系のみを指定しなおした。
再度 configure を試したところ、ビルドシステムの ninja が足りないと言われた。
同26日、これをインストール。
その次には glib-gthread のバージョンが合わないと言われた。
Cygwin の mingw64-x86\_64-glib2.0 はそれほど新しくなかったので、 QEMU の GitLab リポジトリで configure の blame を見ていつこのバージョンを要求するようになったかを調べた。
どうやら6.1.0かららしいので、ビルドする QEMU を6.0.1に妥協。
ここまでの準備をすべて終えるとビルドは待つだけで終わった。
「 Cygwin 上で mingw を使ってものをビルドする」というのが初めてでいまいちお作法が分からず、いくつか困惑。

まず、 mingw 側の DLL は `/usr/x86_64-w64-mingw32/sys-root/mingw/bin` にインストールされるらしく、そこに PATH を通すのは手でやった。
これが正しいのかも分からん。
もう一つが、そうやって DLL を読めるようにしてスモークテストとしての `-version` くらいは走ったとしても、 `make check` の類は走らないらしいということ。
考えてみればそこまで変な話ではなく、「 Cygwin ホストで Windows ネイティブへのクロスコンパイル」をやったから仕方ないということなんだろう。
テストスイートから渡るパスの引数は Cygwin の表記であって、 Windows の立場では(バックスラッシュとスラッシュの読み替えを含めても)読めないものだ、という失敗のしかたしてたわけだし。
