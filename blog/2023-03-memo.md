# PC にインストールするソフトウェアの選定およびインストールの手順

このメモでは、筆者がパーソナルコンピュータ(以下 PC) にインストールしようと考えるソフトウェアを選定する基準、執筆の時点までに選定されたいくつかのソフトウェアとそれらのインストールの手順、および未完了の検討について記述する。

## 選定と手順への要件および基準

要件は次のとおり:
- 実用的であること。
- PC にインストールした一群のソフトウェアからなる作業環境を破損しにくいこと、および破損したときに修復または再構築しやすいこと。

これらの要件から次の基準を導いた:
- これまでの経験から、新しい PC の調達は数年おきであり、構築が済んだ作業環境を破損する機会はそれほど頻繁ではないため、作業環境の(再)構築や修復は数か月かそれ以上の期間を空けて発生すると予想される。
  したがって前回の作業の細部を忘れてしまうだろうと想定し、手順の記述は明確であるほど、より好ましい。
- 作業環境を破損しにくくするため、また破損の範囲を限定するため、作業環境は多層の隔離を計画すべきである。
  - もっとも粗い隔離として PC のユーザアカウントを分離する。
    Microsoft Windows プラットフォームにおいて、筆者の私見では XP/Vista あたりの時期から管理者特権を持たないユーザアカウントを扱うのが容易になった。
    PC のセットアップで作成される管理者ユーザに加えて特権のない一般ユーザを作成し(※1)、管理者特権を使う機会は少ないほど、より好ましい。
  - 強力な隔離として仮想マシンを導入する。
  - 軽量な隔離として、また昨今のソフトウェア配布の経路としてときおり推奨されるため、 Docker ベースのコンテナ技術を導入する。
- 破損を予防するため、また発生した破損を調査するため、それぞれのソフトウェアに関して権威ある文書が容易に入手できるほど望ましい。
  特に、ソフトウェアの実際の動作を定義する文書として非常に正確で非あいまいであるソースコードが入手できるとよい。
  つまり、選定においては FLOSS (自由ソフトウェア・オープンソースソフトウェア)を優先することとし、非 FLOSS が少ないほど、より好ましい。
- (※2) 複数のインストールが1台の PC に共存できることが示唆されるため隔離の観点から、インストーラはインストール先のフォルダを指定できるものが提供されていると望ましい。
  インストールに特別の手順が不要でありアーカイブを適当なフォルダに展開するのみでインストールできるものはさらに良い。

次の節では、以上の基準を筆者のこれまでの努力の範囲で満たした手順を記述する。

## 選定されたソフトウェアおよびそれらのインストール手順

- Microsoft Windows 10 (またはそれ以降)をセットアップする。
  - これは趣味の範疇だが、私物の PC ではここで作成する管理者ユーザに Microsoft アカウントを設定せずローカルアカウントとする。
    現職の社有 PC のうち1台(以下 Foo) でも管理者ユーザはローカルアカウントである。
    現職の社有 PC のうち他の1台は管理者ユーザの作成が済んだ状態で情報システム部から引き渡されたため、設定の細部は不明である。
- 管理者特権を持たない一般ユーザのアカウントを作成する。
  - 私物の PC と Foo においては、一般ユーザも上と同様にローカルアカウントである。
- 管理者ユーザからサインアウトし、今しがた作成した一般ユーザにサインインする。
- Microsoft Edge を起動し、\[設定]→\[ダウンロード]の「ダウンロード時の動作を毎回確認する」を有効にする。
- 引き続き Edge を用いて、 [Mozilla Firefox, Portable Edition](https://portableapps.com/apps/internet/firefox_portable) のうち日本語版かつ作業の時点における最新バージョン(これを `%VERSION%` とする)のインストーラをダウンロードする。
  - 目立つ緑色のリンクは英語版を指していることに注意。
  - ここで Mozilla Firefox, Portable Edition を選んだ理由は上の(※2)である。
  - 上のリンクが指すページではインストーラへのリンクとともに SHA256 ハッシュが提供されている。
  - コマンドプロンプトを起動し、カレントディレクトリが `%USERPROFILE%` であることを仮定する。
    `CertUtil -hashfile Downloads\FirefoxPortable_%VERSION%_Japanese.paf.exe SHA256` を実行し、出力が先のハッシュ値と一致することを確認する。
  - (省略可能) 他の Web ブラウザが利用できる場合は、それらのブラウザで上のページを開き同一のハッシュ値が表示されることを確認すると、わずかではあるがさらに良い。
    - 私物の PC では(この手順に関係なくインストール済みだった) Google Chrome を用いた(はずだ; 記録を残していたわけではない)。
    - Foo へのインストールにおいては、(また関係なく私物の PC にインストール済みだった)ある Firefox 派生ブラウザを用いてこの比較を行った。
      Foo にインストールされているインターネットセキュリティスイートは、検査の目的でシステムの証明書ストアにインストールするルート証明書を用いて TLS 通信に介入してくるので、これの影響を受けない私物の PC で同じハッシュ値を見ることに意味があった。
  - インストーラの実行ファイルのプロパティ→\[デジタル署名]タブを開き、有効な署名があることを確認する。
  - 現職の社有 PC においては、インストールされている指定のインターネットセキュリティスイートでこのインストーラを検査し、脅威が何も見つからないことを確認する。
    情報システム部との合意により、ソフトウェアの名称で Web 検索しマルウェアの感染にかかわる情報が見当たらないことを確認する。
    ついでではあるが、インストーラの MD5 または SHA1 または SHA256 ハッシュ値についても検索して同様の確認をしておく。
    以下のステップでは記述を省略するが、現職の社有 PC におけるこの検査と Web 検索はこれ以降インストールする他のソフトウェアについても同様に行う。
- ダウンロードおよび検査したインストーラを用いて Mozilla Firefox, Portable Edition をインストールする。
  インストール先は例えば `%USERPROFILE%\Documents\opt\FirefoxPortable` などとする。
  インストーラの最後の画面で「Mozilla Firefox, Portable Editionを実行」などというチェックボックスがあれば、チェックを外してから完了する。
- PC が Ethernet 接続であればケーブルを抜去し、無線 LAN への接続があれば無効化する。
  これに限らず、ネットワーク接続があれば一時的に無効化し、PC をオフラインにする。
  - コマンドプロンプトから `Documents\opt\FirefoxPortable\FirefoxPortable -safe-mode` を実行する。
  - \[ツール]メニュー→\[設定]→\[一般]のうち「DRM 制御のコンテンツを再生」のチェックボックスからチェックを外す。
  - \[ツール]メニュー→\[アドオンとテーマ]で次の変更を加える:
    - 「Widevine Content Decryption Module provided (Google Inc. 提供)」といった名前のアドオンがこの時点でまだ表示されていれば無効化する。
    - 現職の社有 PC に限っては「OpenH264 Video Codec (Cisco Systems, Inc. 提供)」も無効化する。
  - Firefox Portable を一度終了してから `-safe-mode` のスイッチ抜きで再び起動し、上で無効にした項目が無効なままであることを確認する。
  - この項目の親にあたるステップで無効化したネットワーク接続を元に戻す。
- GnuPG
- PeaZip
- MSYS2

## 付録: 避けた選択肢

執筆の時点までに避けることにした選択肢のうち一部を紹介する:
- (※1)について、管理者ユーザを常用しつつ UAC メカニズムによる一時的な昇格をもって分離とする運用が世間では一般的ではあろうが、盾のアイコンのボタンを1回クリックするだけで昇格できてしまうのは筆者の私見では不用心すぎるため、採用しない。
- WSL2
- gnupack Cygwin
